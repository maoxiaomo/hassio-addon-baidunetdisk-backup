# ç™¾åº¦ç½‘ç›˜å¤‡ä»½ - Home Assistant Add-on

![Version](https://img.shields.io/badge/version-1.0.1-blue.svg)
![Auth](https://img.shields.io/badge/è®¤è¯æ–¹å¼-OAuth_2.0-green.svg)
![Python](https://img.shields.io/badge/Python-3.11-yellow.svg)

ä¸€ä¸ªç”¨äº Home Assistant çš„ Supervisor åŠ è½½é¡¹ (Add-on)ï¼Œå¯ä»¥è‡ªåŠ¨å°†æ‚¨çš„ HA å¤‡ä»½æ–‡ä»¶åŒæ­¥ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜ã€‚

> **v1.0.1 æ›´æ–°å‘å¸ƒï¼**
>
> é‡‡ç”¨ä¸ **AList** å®Œå…¨ç›¸åŒçš„ç™¾åº¦å®˜æ–¹ OAuth 2.0 æ¥å£å’Œ API è°ƒç”¨æ–¹å¼ï¼Œç¨³å®šå¯é ã€‚

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

- **ğŸš€ å®˜æ–¹è®¤è¯**ï¼šä½¿ç”¨ç™¾åº¦å®˜æ–¹ OAuth 2.0 æˆæƒæ¥å£ï¼Œç¨³å®šå¯é ï¼Œæ— å°é”é£é™©ã€‚
- **ğŸ”„ è‡ªåŠ¨ç»­æœŸ**ï¼šå†…ç½® Token è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼Œä¸€æ¬¡ç™»å½•ï¼Œæ°¸ä¹…æœ‰æ•ˆã€‚
- **âš¡ æé€Ÿç§’ä¼ **ï¼šåˆ©ç”¨ç™¾åº¦ç½‘ç›˜ç§’ä¼ æœºåˆ¶ï¼ŒGB çº§æ–‡ä»¶ä¹Ÿèƒ½ç¬é—´å®Œæˆå¤‡ä»½ã€‚
- **ğŸ“¦ åˆ†ç‰‡ä¸Šä¼ **ï¼šå¤§æ–‡ä»¶è‡ªåŠ¨åˆ†ç‰‡ä¸Šä¼ ï¼Œç½‘ç»œæ³¢åŠ¨ä¹Ÿèƒ½æ–­ç‚¹ç»­ä¼ ã€‚
- **â° çµæ´»å®šæ—¶**ï¼šæ”¯æŒ Cron è¡¨è¾¾å¼é…ç½®ï¼Œç²¾ç¡®æ§åˆ¶å¤‡ä»½æ—¶é—´ã€‚
- **ğŸ§¹ åˆ†å±‚ä¿ç•™**ï¼šæ”¯æŒè¿œç«¯å¤‡ä»½åˆ†å±‚ä¿ç•™ç­–ç•¥ï¼ˆdaily/weekly/monthlyï¼‰ï¼Œè‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½ï¼Œé¿å…ç½‘ç›˜å®¹é‡æŒç»­å¢é•¿ã€‚
- **ğŸ—‚ï¸ ç›®å½•æ¨¡å¼ï¼ˆå¯é€‰ï¼‰**ï¼šåœ¨ `upload_path` ä¸‹è‡ªåŠ¨åˆ›å»º `daily/`ã€`weekly/`ã€`monthly/` ä¸‰ä¸ªç›®å½•å¹¶åˆ†ç±»å­˜æ”¾ï¼ˆé€šè¿‡ç§»åŠ¨å½’æ¡£ï¼Œä¸é‡å¤å ç”¨ç©ºé—´ï¼‰ã€‚

---

## ğŸ› ï¸ å®‰è£…æ–¹æ³•

**åœ°å€**ï¼šhttps://gitee.com/mxmaimooo/hassio-addon-baidunetdisk-backup

**Githubæº**ï¼šhttps://github.com/maoxiaomo/hassio-addon-baidunetdisk-backup

### ğŸš€ ä¸€é”®å®‰è£…ï¼ˆæ¨èï¼‰

ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œç›´æ¥åœ¨ Home Assistant ä¸­æ·»åŠ æœ¬æ’ä»¶ï¼ˆä½¿ç”¨ Gitee å›½å†…æºï¼‰ï¼š

[![Open your Home Assistant instance and show the add-on store.](https://my.home-assistant.io/badges/supervisor_add_addon_repository.svg)](https://my.home-assistant.io/redirect/supervisor_add_addon_repository/?repository_url=https%3A%2F%2Fgitee.com%2Fmxmaimooo%2Fhassio-addon-baidunetdisk-backup)

### æ‰‹åŠ¨å®‰è£…
1. å¤åˆ¶ä¸Šé¢çš„ Gitee åœ°å€ã€‚
2. è¿›å…¥ Home Assistantï¼š**é…ç½®** > **åŠ è½½é¡¹** > **åŠ è½½é¡¹å•†åº—**ã€‚
3. ç‚¹å‡»å³ä¸Šè§’èœå•ï¼ˆä¸‰ä¸ªç‚¹ï¼‰ > **ä»“åº“**ã€‚
4. ç²˜è´´åœ°å€å¹¶ç‚¹å‡» **æ·»åŠ **ã€‚
5. åˆ·æ–°é¡µé¢ï¼Œæ‰¾åˆ° **ç™¾åº¦ç½‘ç›˜å¤‡ä»½** å¹¶ç‚¹å‡»å®‰è£…ã€‚

---

## ğŸ”‘ è·å– Refresh Tokenï¼ˆé‡è¦ï¼ï¼‰

> ğŸ›‘ **æ“ä½œå‰å¿…è¯»**ï¼šè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ“ä½œï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æˆæƒå¤±è´¥ã€‚

### ç¬¬ä¸€æ­¥ï¼šç™»å½•ç™¾åº¦ç½‘ç›˜
è¯·å…ˆåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ [ç™¾åº¦ç½‘ç›˜å®˜ç½‘](https://pan.baidu.com) å¹¶**ç™»å½•æ‚¨çš„ç™¾åº¦è´¦å·**ã€‚
*(å»ºè®®ä½¿ç”¨ PC ç«¯æµè§ˆå™¨æ“ä½œ)*

### ç¬¬äºŒæ­¥ï¼šè·å–æˆæƒ
ç™»å½•æˆåŠŸåï¼Œç‚¹å‡»ä¸‹æ–¹é“¾æ¥è¿›è¡Œæˆæƒï¼š

ğŸ‘‰ **[ç‚¹å‡»è¿™é‡Œè·å– Refresh Token](https://openapi.baidu.com/oauth/2.0/authorize?response_type=code&client_id=hq9yQ9w9kR4YHj1kyYafLygVocobh7Sf&redirect_uri=https://alistgo.com/tool/baidu/callback&scope=basic,netdisk&qrcode=1)**

### ç¬¬ä¸‰æ­¥ï¼šå¤åˆ¶ Token
æˆæƒé¡µé¢ä¼šæ˜¾ç¤ºå¦‚ä¸‹ JSON ä¿¡æ¯ï¼Œè¯·å¤åˆ¶ **`refresh_token`** åé¢çš„å­—ç¬¦ä¸²ï¼š

```json
{
  "access_token": "121.xxxxxxxx...",
  "refresh_token": "122.a0b1c2d3...",   <-- å¤åˆ¶è¿™ä¸€é•¿ä¸²å­—ç¬¦
  "expires_in": 2592000
}
```

> **æ³¨æ„**ï¼šåªå¤åˆ¶ `122.` å¼€å¤´çš„é‚£ä¸€é•¿ä¸²å­—ç¬¦ï¼Œä¸è¦åŒ…å«å¼•å·ã€‚

### ç¬¬å››æ­¥ï¼šå¡«å…¥é…ç½®
å›åˆ° Home Assistant Add-on çš„ **é…ç½®** é¡µé¢ï¼Œå°†å¤åˆ¶çš„å­—ç¬¦ç²˜è´´åˆ° `refresh_token` å­—æ®µä¸­ã€‚

---

## âš™ï¸ é…ç½®è¯´æ˜

| é…ç½®é¡¹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :---: | :--- | :--- |
| `refresh_token` | âœ… | (æ— ) | **å¿…å¡«**ã€‚ä»ä¸Šä¸€æ­¥è·å–çš„ä»¤ç‰Œã€‚ |
| `upload_path` | âŒ | `/HomeAssistant/Backup` | ç½‘ç›˜ä¸­çš„ç›®æ ‡æ–‡ä»¶å¤¹è·¯å¾„ã€‚ä¼šè‡ªåŠ¨åˆ›å»ºã€‚ |
| `schedule` | âŒ | `0 5 * * *` | å®šæ—¶ä»»åŠ¡çš„ Cron è¡¨è¾¾å¼ã€‚ |
| `retention.daily` | âŒ | (ä¸å¯ç”¨) | è¿œç«¯ä¿ç•™ï¼šæŒ‰â€œå¤©â€ä¿ç•™æœ€è¿‘ N ä»½ï¼ˆåŒä¸€å¤©å¤šä»½åªä¿ç•™æœ€æ–°ä¸€ä»½ï¼‰ã€‚ |
| `retention.weekly` | âŒ | (ä¸å¯ç”¨) | è¿œç«¯ä¿ç•™ï¼šæŒ‰â€œå‘¨â€ä¿ç•™æœ€è¿‘ N ä»½ï¼ˆåŒä¸€å‘¨åªä¿ç•™æœ€æ–°ä¸€ä»½ï¼‰ã€‚ |
| `retention.monthly` | âŒ | (ä¸å¯ç”¨) | è¿œç«¯ä¿ç•™ï¼šæŒ‰â€œæœˆâ€ä¿ç•™æœ€è¿‘ N ä»½ï¼ˆåŒä¸€æœˆåªä¿ç•™æœ€æ–°ä¸€ä»½ï¼‰ã€‚ |
| `retention.use_folders` | âŒ | `false` | æ˜¯å¦å¯ç”¨ç›®å½•æ¨¡å¼ã€‚å¯ç”¨åä¼šåœ¨ `upload_path` ä¸‹ä½¿ç”¨ `daily/weekly/monthly` ä¸‰ä¸ªå­ç›®å½•ã€‚ |

### ğŸ“ é…ç½®ç¤ºä¾‹

```yaml
refresh_token: "122.a0b1c2d3e4f5g6h7i8j9k0l1m2n3o4p5..."
upload_path: "/HomeAssistant/Backup"
schedule: "0 5 * * *"  # æ¯å¤©å‡Œæ™¨5ç‚¹æ‰§è¡Œ

# è¿œç«¯åˆ†å±‚ä¿ç•™ï¼ˆæ¨èï¼šdaily=7ã€weekly=4ã€monthly=12ï¼‰
retention:
  daily: 7
  weekly: 4
  monthly: 12

# å¯é€‰ï¼šå¼€å¯ç›®å½•æ¨¡å¼ï¼ˆäº‘ç«¯ä¼šä½¿ç”¨ /HomeAssistant/Backup/daily|weekly|monthly ä¸‰ä¸ªç›®å½•ï¼‰
  use_folders: true
```

### â° Cron è¡¨è¾¾å¼å‚è€ƒ

- `0 5 * * *` : æ¯å¤©å‡Œæ™¨ 5:00 (é»˜è®¤)
- `30 2 * * *` : æ¯å¤©å‡Œæ™¨ 2:30
- `0 */4 * * *` : æ¯ 4 å°æ—¶æ‰§è¡Œä¸€æ¬¡
- `0 1 * * 1` : æ¯å‘¨ä¸€å‡Œæ™¨ 1:00

---

## ğŸ“‚ å·¥ä½œæœºåˆ¶

1. **å¯åŠ¨æ£€æŸ¥**ï¼šæ’ä»¶å¯åŠ¨æ—¶ï¼Œä¼šç«‹å³æ‰«æ `/backup` ç›®å½•ï¼Œå¹¶å°è¯•ä¸Šä¼ **æ‰€æœ‰** `.tar` å¤‡ä»½æ–‡ä»¶ã€‚
2. **å®šæ—¶è½®è¯¢**ï¼šæ ¹æ® `schedule` è®¾å®šçš„æ—¶é—´ï¼Œå®šæœŸå”¤é†’å¹¶æ‰§è¡Œå…¨é‡åŒæ­¥ä»»åŠ¡ã€‚
3. **æ™ºèƒ½ä¸Šä¼ **ï¼š
   - ä¸Šä¼ å‰ä¼šè‡ªåŠ¨è®¡ç®—æ–‡ä»¶ MD5ã€‚
   - å¦‚æœç½‘ç›˜ä¸­å·²å­˜åœ¨ç›¸åŒæ–‡ä»¶ï¼Œåˆ™è§¦å‘**ç§’ä¼ **ï¼Œæ— éœ€æ¶ˆè€—æµé‡ã€‚
   - åªæœ‰æ–°æ–‡ä»¶æˆ–æœªä¸Šä¼ çš„æ–‡ä»¶æ‰ä¼šè¿›è¡Œå®é™…ä¼ è¾“ã€‚

---

## â“ å¸¸è§é—®é¢˜ (FAQ)

#### Q: ç‚¹å‡»æˆæƒé“¾æ¥æç¤ºé”™è¯¯ï¼Ÿ
**A:** è¿™é€šå¸¸æ˜¯å› ä¸ºæ‚¨æ²¡æœ‰å…ˆåœ¨æµè§ˆå™¨ä¸­ç™»å½•ç™¾åº¦ç½‘ç›˜ã€‚è¯·å…ˆè®¿é—® pan.baidu.com ç™»å½•ï¼Œç„¶åå†ç‚¹å‡»æˆæƒé“¾æ¥ã€‚

#### Q: å¤‡ä»½æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ
**A:** é»˜è®¤æƒ…å†µä¸‹æ–‡ä»¶ä½äºç™¾åº¦ç½‘ç›˜çš„ **`/HomeAssistant/Backup`** ç›®å½•ä¸‹ã€‚è‹¥å¼€å¯ç›®å½•æ¨¡å¼ï¼ˆ`retention.use_folders: true`ï¼‰ï¼Œåˆ™ä¼šå­˜æ”¾åœ¨ï¼š

- `upload_path/daily/`
- `upload_path/weekly/`
- `upload_path/monthly/`

#### Q: Token ä¼šè¿‡æœŸå—ï¼Ÿéœ€è¦å®šæœŸæ›´æ¢å—ï¼Ÿ
**A:** ä¸éœ€è¦ã€‚æ’ä»¶å†…ç½®äº† Token è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼Œåªè¦æ‚¨ä¸å–æ¶ˆæˆæƒï¼ŒToken ä¼šä¸€ç›´è‡ªåŠ¨ç»­æœŸã€‚

#### Q: ä¸ºä»€ä¹ˆæ—¥å¿—æ˜¾ç¤º "Rapid upload (ç§’ä¼ ) successful"ï¼Ÿ
**A:** è¿™è¡¨ç¤ºæ‚¨çš„å¤‡ä»½æ–‡ä»¶åœ¨ç™¾åº¦ç½‘ç›˜äº‘ç«¯å·²ç»å­˜åœ¨ï¼ˆå¯èƒ½æ˜¯æ‚¨æ‰‹åŠ¨ä¸Šä¼ è¿‡ï¼Œæˆ–è€…ä¹‹å‰çš„ä»»åŠ¡å·²ç»ä¸Šä¼ æˆåŠŸï¼‰ï¼Œå› æ­¤æ’ä»¶è·³è¿‡äº†å®é™…ä¼ è¾“ï¼Œç›´æ¥å®Œæˆäº†"ä¸Šä¼ "ã€‚è¿™æ˜¯æ­£å¸¸ä¸”é«˜æ•ˆçš„è¡¨ç°ã€‚

#### Q: æœ¬åœ°åˆ é™¤äº†å¤‡ä»½ï¼Œç½‘ç›˜ä¸Šä¹Ÿä¼šåˆ é™¤å—ï¼Ÿ
**A:** åˆ†ä¸¤ç§æƒ…å†µï¼š

- **æœªå¯ç”¨ä¿ç•™ç­–ç•¥**ï¼ˆä¸é…ç½® `retention.daily/weekly/monthly`ï¼‰ï¼šç½‘ç›˜ä¸ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œè¡¨ç°ä¸º"åªå¢ä¸å‡"ã€‚
- **å¯ç”¨ä¿ç•™ç­–ç•¥**ï¼ˆé…ç½®äº† `retention.daily/weekly/monthly`ï¼‰ï¼šæ’ä»¶ä¼šåœ¨äº‘ç«¯æŒ‰ä¿ç•™è§„åˆ™è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½ã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆä¸è‡´è°¢

æœ¬é¡¹ç›®åŸºäºä»¥ä¸‹ä¼˜ç§€çš„å¼€æºæŠ€æœ¯æ„å»ºï¼š

- **Python 3**: æ ¸å¿ƒé€»è¾‘å®ç°
- **Requests**: å¤„ç† HTTP é€šè®¯ä¸ API äº¤äº’
- **Alpine Linux**: æä¾›è¶…è½»é‡çº§çš„ Docker è¿è¡Œç¯å¢ƒ
- **AList**: æ„Ÿè°¢ [AList](https://github.com/alist-org/alist) é¡¹ç›®æä¾›çš„ç™¾åº¦ç½‘ç›˜ OAuth 2.0 é‰´æƒæ–¹æ¡ˆï¼Œæå¤§åœ°ç®€åŒ–äº†å¼€å‘æµç¨‹ã€‚

---

## é—®é¢˜åé¦ˆ

> âš ï¸ **å£°æ˜**ï¼šæœ¬é¡¹ç›®ç›®å‰å¤„äº**ç»´æŠ¤é˜¶æ®µ**ï¼Œéµå¾ªã€Œèƒ½ç”¨å°±ä¸æ”¹ã€åŸåˆ™ã€‚
> 
> ä½œè€…åªä¼šä¿®å¤å½±å“**è‡ªå·±ä½¿ç”¨**çš„é—®é¢˜ï¼Œä¸€åˆ‡ä»¥ä¸ªäººåˆ©ç›Šä¸ºé‡ã€‚æ¬¢è¿ Fork è‡ªè¡Œä¿®æ”¹ã€‚
